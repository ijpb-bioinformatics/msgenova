---
title: "Report"
author: " "
date: "2022-08-16"
output:
    html_document:
        number_sections: yes
params:
  DP.min: DP.min
  AR.min: AR.min
  qual.min: qual.min
  result_dir: result_dir
  sample_sheet: sample_sheet
  rmd: "report.Rmd"
  AR: AR
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE , warning=FALSE, error=FALSE, message=FALSE)
```

```{r}
# title: "`r params$title`"
# workspace<-params$result_dir
# sample_sheet.file <- params$sample_sheet
# DP.min <- params$DP.min
# AR.min <- params$AR.min
# qual.min <- params$qual.min

projectName <- "PE-WGS"

workspace <- "/Users/nbentahar/Desktop/msgenova_test/PE_WGS/results"
#workspace <- "/Users/nbentahar/Documents/PROJECTs/DEV/msgenova/examples/soj/results/"

sample_sheet.file <- "/Users/nbentahar/Desktop/msgenova_test/PE_WGS/sample_sheet_PE.txt"
#sample_sheet.file <- "/Users/nbentahar/Documents/PROJECTs/DEV/msgenova/examples/soj/sample_sheet_soj_3samples.txt"

DP.min <- 4
AR.min <- 0.8
qual.min <- 30

# results
trim.file <- paste0(workspace,"/01_sequence_qc/log/trimmomatic.log")
vcf.file <- paste0(workspace,"/03_snv_indels_calling/", projectName , "_snv_indel.vcf")
sv.file  <- paste0(workspace,"/04_sv_calling/", projectName , "_sv.vcf")

if(!file.exists(sample_sheet.file)) stop("Error: ")
if(!file.exists(trim.file)) stop("Error: ")
if(!file.exists(vcf.file)) stop("Error: ")

eval.SV <- file.exists(sv.file)


  
```


```{r }
library(DT)
library(ggplot2)
library(vcfR)
library(dplyr)
library(tidyr)
library(yaml)
library(stringr)
library(ComplexHeatmap)
library(gplots)
source("functions.R")


```



# Samples
```{r}

sample_sheet <- read.table(file = sample_sheet.file, header = TRUE, sep = "\t")

unique(sample_sheet$sample)
```
List of samples : `r unique(sample_sheet$sample)`

```{r}

dplyr::select(sample_sheet, sample, condition) %>% unique() %>% dplyr::group_by(condition) %>% dplyr::count(name = "nb_samples") %>% 
  knitr::kable(align = "lccrr")
 # DT::datatable(rownames = FALSE, options = list(rownames = TRUE, pageLength = 10, scrollX = T, dom = 'tip'),class = 'cell-border stripe')

```



<!-- # Quality control -->

```{r quality_control}

  out <- NULL

  out <- c(out, knitr::knit_child("quality_control.Rmd"), quiet=TRUE)
    
  knitr::asis_output(out)

```

<!-- # SNV and Small InDels Detection -->

```{r SNV_InDels_calling}

  out <- NULL

  out <- c(out, knitr::knit_child("SNV_InDels_calling.Rmd"), quiet=TRUE)
    
knitr::asis_output(out)

```

<!-- # SV Detection -->

```{r SV_calling, eval=eval.SV}

  out <- NULL

  out <- c(out, knitr::knit_child("SV_calling.Rmd"), quiet=TRUE)
    
knitr::asis_output(out)

```

```{r tDNA_scan, eval=FALSE, include=FALSE}

  out <- NULL

  out <- c(out, knitr::knit_child("tDNA_scan.Rmd"), quiet=TRUE)
    
knitr::asis_output(out)

```


```{r tools, eval=FALSE}

  out <- NULL
  
  out <- c(out, knitr::knit_child("tools.Rmd"), quiet=TRUE)
    
knitr::asis_output(out)

```
